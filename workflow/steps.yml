generate:
  process:
    process_type: interpolated-script-cmd
    interpreter: bash
    script: |
      source /usr/local/bin/thisroot.sh
      python /code/generantuple.py {type} {nevents} {outputfile}
  environment:
    environment_type: docker-encapsulated
    image: dummyanalysis
  publisher:
    publisher_type: 'frompar-pub'
    outputmap:
      outputfile: 'outputfile'

select:
  process:
    process_type: interpolated-script-cmd
    interpreter: bash
    script: |
      source /usr/local/bin/thisroot.sh
      python /code/select.py {inputfile} {outputfile} {region} nominal
  environment:
    environment_type: docker-encapsulated
    image: dummyanalysis
  publisher:
    publisher_type: 'frompar-pub'
    outputmap:
      outputfile: 'outputfile'

select_mc:
  process:
    process_type: interpolated-script-cmd
    interpreter: bash
    script: |
      source /usr/local/bin/thisroot.sh
      variations=$(cat /parmounts/variations|sed 's|"||g'|paste -sd , -)
      python /code/select.py {inputfile} {outputfile} {region} $variations
  environment:
    environment_type: docker-encapsulated
    image: dummyanalysis
    par_mounts:
      - mountpath: /parmounts/variations
        jqscript: .variations[]
  publisher:
    publisher_type: 'frompar-pub'
    outputmap:
      outputfile: 'outputfile'

histogram:
  process:
    process_type: interpolated-script-cmd
    interpreter: bash
    script: |
      source /usr/local/bin/thisroot.sh
      variations=$(cat /parmounts/variations|sed 's|"||g'|paste -sd , -)
      python /code/histogram.py {inputfile} {outputfile} {name} {weight} $variations
  environment:
    environment_type: docker-encapsulated
    image: dummyanalysis
    par_mounts:
      - mountpath: /parmounts/variations
        jqscript: .variations[]
  publisher:
    publisher_type: 'frompar-pub'
    outputmap:
      outputfile: 'outputfile'


merge_root:
  process:
    process_type: interpolated-script-cmd
    interpreter: bash
    script: |
      source /usr/local/bin/thisroot.sh
      cat /parmounts/inputs|sed 's|"||g' |xargs hadd {mergedfile}
  environment:
    environment_type: docker-encapsulated
    image: rootproject/root-ubuntu16
    par_mounts:
      - mountpath: '/parmounts/inputs'
        jqscript: '.inputs[]'
  publisher:
    publisher_type: 'frompar-pub'
    outputmap:
      mergedfile: 'mergedfile'

merge_root_allpars:
  process:
    process_type: interpolated-script-cmd
    interpreter: bash
    script: |
      source /usr/local/bin/thisroot.sh
      cat /parmounts/inputs|sed 's|"||g' |xargs hadd {mergedfile}
  environment:
    environment_type: docker-encapsulated
    image: rootproject/root-ubuntu16
    par_mounts:
      - mountpath: '/parmounts/inputs'
        jqscript: 'to_entries[]|select(.key != "mergedfile").value'
  publisher:
    publisher_type: 'frompar-pub'
    outputmap:
      mergedfile: 'mergedfile'

plot:
  process:
    process_type: interpolated-script-cmd
    interpreter: bash
    script: |
      source /usr/local/bin/thisroot.sh
      python plot.py {inputfile} {plotfile}
  environment:
    environment_type: docker-encapsulated
    image: dummyanalysis
  publisher:
    publisher_type: 'frompar-pub'
    outputmap:
      plotfile: 'plotfile'
